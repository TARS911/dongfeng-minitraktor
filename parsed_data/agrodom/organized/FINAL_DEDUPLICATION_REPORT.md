# Финальный отчёт об очистке данных от дубликатов

**Дата:** 2025-11-18

## Резюме

Выполнена полная очистка базы данных запчастей от дубликатов с последующей регенерацией всех файлов.

## Процесс очистки

### 1. Анализ исходных данных

**Найдено:**
- Всего товаров: **2836**
- Уникальных названий: **2833**
- Дубликатов: **3**

### 2. Удалённые дубликаты

| # | Название | Оставлено | Удалено | Причина |
|---|----------|-----------|---------|---------|
| 1 | Корпус Гидробака DongFeng 354/404 | Запись с ценой (17 480₽) | Запись без цены | Больше информации |
| 2 | Лапа Окучника | Запись из категории "Навесное оборудование" (4 540₽) | Запись из категории "Прочее" (3 150₽) | Правильная категория + score 20 vs 18 |
| 3 | Первый Вал ОМ Синтай/Xingtai 244 | Запись с ценой (1 650₽) | Запись без цены | Больше информации |

### 3. Критерии выбора

При наличии дубликатов оставлялась запись с максимальным **score**:

- Есть цена: **+10 баллов**
- Есть изображение: **+5 баллов**
- Есть SKU: **+3 балла**
- Есть категория: **+2 балла**
- Есть подкатегория: **+2 балла**
- Есть бренд: **+1 балл**

## Результаты очистки

### Итоговая статистика

| Параметр | До очистки | После очистки | Изменение |
|----------|-----------|---------------|-----------|
| Всего товаров | 2836 | 2833 | **-3** |
| Уникальных названий | 2833 | 2833 | 0 |
| Уникальных ссылок | 2836 | 2833 | **-3** |
| Процент уникальности | 99.89% | **100%** | +0.11% |

### Обновлённые файлы

#### JSON файлы
- ✅ `all-parts-organized.json` - **2833 товара**
- ✅ `by-brand/` - 9 файлов по брендам
- ✅ `by-category/` - 18 файлов по категориям
- ✅ `by-brand/Уралец-Xingtai.json` - **509 товаров** (497 + 12)

#### CSV файлы
- ✅ `csv/all-parts-organized.csv` - **2833 записи**
- ✅ `csv/by-brand/` - 9 файлов
- ✅ `csv/by-category/` - 18 файлов
- ✅ `csv/by-brand/Уралец-Xingtai.csv` - **509 записей**

#### SQL миграция
- ✅ `backend/database/supabase-parts-data.sql`
  - **2833 INSERT statements**
  - Размер: **3051.6 KB** (было 3054.7 KB)
  - Готов к импорту в Supabase PostgreSQL

- ✅ `sql/Уралец-Xingtai-parts.sql`
  - **509 INSERT statements**

## Распределение по брендам (после очистки)

| Бренд | Товаров | Изменение |
|-------|---------|-----------|
| Универсальные | 1692 | -1 |
| Уралец | 497 | -1 |
| Jinma | 335 | 0 |
| DongFeng | 211 | -1 |
| Foton | 36 | 0 |
| Shifeng | 29 | 0 |
| Scout | 20 | 0 |
| Xingtai | 12 | 0 |
| YTO | 1 | 0 |
| **ИТОГО** | **2833** | **-3** |

## Распределение по категориям (после очистки)

| Категория | Товаров | Изменение |
|-----------|---------|-----------|
| Навесное оборудование | 563 | -1 |
| Двигатель | 561 | 0 |
| Прочее | 437 | -1 |
| Стандартные изделия | 335 | 0 |
| Трансмиссия | 233 | 0 |
| Гидравлика | 198 | -1 |
| Карданные валы | 112 | 0 |
| Передний мост | 71 | 0 |
| Фильтры | 69 | 0 |
| Электрооборудование | 64 | 0 |
| Рулевое управление | 55 | 0 |
| Тормозная система | 40 | 0 |
| Кабина | 39 | 0 |
| Топливная система | 21 | 0 |
| Капот и крылья | 18 | 0 |
| Колеса и шины | 11 | 0 |
| РВД | 4 | 0 |
| Сиденья | 2 | 0 |
| **ИТОГО** | **2833** | **-3** |

## Созданные бэкапы

- ✅ `parsed_data/agrodom/products-clean.json.backup` - исходный файл с дубликатами
- ✅ `parsed_data/agrodom/organized/all-parts-organized.json.backup` - организованный файл с дубликатами

## Проверка качества

### Тесты на дубликаты

✅ **По названию:** 0 дубликатов
✅ **По названию + цене:** 0 дубликатов
✅ **По ссылке:** 0 дубликатов

### Целостность данных

✅ Все товары имеют уникальные названия
✅ Все ссылки уникальны
✅ Все категории корректны
✅ Все бренды корректны

## Готовность к импорту

### Supabase PostgreSQL

```bash
# Импорт в Supabase
psql -h your-project.supabase.co -U postgres -d postgres -f backend/database/supabase-parts-data.sql
```

Или через Supabase Dashboard → SQL Editor:
1. Открыть SQL Editor
2. Загрузить файл `supabase-parts-data.sql`
3. Выполнить миграцию

### Excel/Google Sheets

Импортировать CSV файлы из `parsed_data/agrodom/organized/csv/` с кодировкой UTF-8.

## Скрипты очистки

1. **`scripts/find-duplicates.py`** - поиск дубликатов
2. **`scripts/remove-duplicates.py`** - удаление дубликатов из организованных данных
3. **`scripts/deduplicate-source.py`** - очистка исходного файла products-clean.json

## Команда для повторной очистки

```bash
# Полная очистка и регенерация
python3 scripts/deduplicate-source.py && \
python3 scripts/organize-parts-by-categories.py && \
python3 scripts/export-organized-to-csv.py && \
python3 scripts/convert-agrodom-to-postgres.py && \
python3 scripts/merge-uralets-xingtai.py
```

---

✅ **База данных полностью очищена от дубликатов и готова к импорту в Supabase!**
