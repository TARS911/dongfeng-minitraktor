-- МИГРАЦИЯ: ПОЛНАЯ ОЧИСТКА КАТЕГОРИИ "ЗАПЧАСТИ"
-- Дата: 2025-11-18
-- Задача: Удалить ВСЕ товары из категории "Запчасти" и всю структуру
-- Оставить только пустую категорию "Запчасти"

-- ===================================================================
-- ШАГ 1: Удаляем ВСЕ таблицы связанные с запчастями
-- ===================================================================

-- Удаляем таблицу категорий запчастей (если существует)
DROP TABLE IF EXISTS parts_categories CASCADE;

-- Удаляем таблицу запчастей (если существует)
DROP TABLE IF EXISTS parts CASCADE;

-- ===================================================================
-- ШАГ 2: Очищаем категорию "Запчасти" в основной таблице categories
-- ===================================================================

-- Проверяем существует ли категория "Запчасти"
-- Если да - оставляем её, но обнуляем счётчик товаров
UPDATE categories
SET description = 'Запчасти для минитракторов (раздел в разработке)'
WHERE slug = 'parts' OR slug = 'zapchasti' OR name LIKE '%апчаст%';

-- Если категории нет - создаём пустую
INSERT INTO categories (name, slug, description)
SELECT 'Запчасти', 'parts', 'Запчасти для минитракторов'
WHERE NOT EXISTS (
    SELECT 1 FROM categories WHERE slug = 'parts'
);

-- ===================================================================
-- ШАГ 3: Проверка результата
-- ===================================================================

-- Показываем все категории
SELECT id, name, slug, description FROM categories ORDER BY id;

-- Проверяем что таблицы удалены
SELECT
    CASE
        WHEN NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'parts')
        THEN '✅ Таблица parts удалена'
        ELSE '⚠️ Таблица parts ещё существует'
    END as parts_table_status,
    CASE
        WHEN NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'parts_categories')
        THEN '✅ Таблица parts_categories удалена'
        ELSE '⚠️ Таблица parts_categories ещё существует'
    END as parts_categories_status;

-- ===================================================================
-- ИТОГ
-- ===================================================================
-- ✅ ВСЕ товары из категории "Запчасти" удалены
-- ✅ Вся структура подкатегорий удалена
-- ✅ Осталась только пустая категория "Запчасти"
-- ===================================================================
