-- ============================================================================
-- ИСПРАВЛЕНИЕ КОНВЕРТАЦИИ: Оставшиеся 90 товаров TATA-AGRO
-- Курс: 1 UAH = 1.85 RUB
-- ============================================================================
-- Запустите в: https://supabase.com/dashboard/project/dpsykseeqloturowdyzf/sql
-- ============================================================================

-- ШАГ 1: ПОКАЗАТЬ ТОВАРЫ ДО КОНВЕРТАЦИИ
-- ============================================================================
SELECT
    'ТОВАРЫ ДО КОНВЕРТАЦИИ (UAH)' as status,
    COUNT(*) as total,
    MIN(price) as min_uah,
    MAX(price) as max_uah,
    ROUND(AVG(price), 2) as avg_uah
FROM products
WHERE id IN (
    8206,8211,8213,8234,8244,8240,8243,8239,8235,8237,8236,8259,8252,8253,8255,8258,
    8249,8260,8254,8256,8261,8272,8251,8284,8287,8262,8304,8308,8296,8299,8300,8307,
    8293,8283,8297,8309,8337,8333,8340,8339,8352,8355,8353,8354,8360,8361,8368,8375,
    8376,8381,8382,8374,8365,8383,8380,8399,8390,8424,8425,8426,8427,8431,8434,8423,
    8448,8449,8450,8452,8444,8445,8454,8456,8458,8457,8460,8491,8502,8504,10241,
    21051,21073,21052,21108,11015,10260,10262,10259,9136,8356,10198
);

-- Примеры товаров
SELECT
    id,
    price as price_uah,
    ROUND(price * 1.85, 2) as will_be_rub,
    LEFT(name, 50) as product_name
FROM products
WHERE id IN (
    8206,8211,8213,8234,8244,8240,8243,8239,8235,8237,8236,8259,8252,8253,8255,8258,
    8249,8260,8254,8256,8261,8272,8251,8284,8287,8262,8304,8308,8296,8299,8300,8307,
    8293,8283,8297,8309,8337,8333,8340,8339,8352,8355,8353,8354,8360,8361,8368,8375,
    8376,8381,8382,8374,8365,8383,8380,8399,8390,8424,8425,8426,8427,8431,8434,8423,
    8448,8449,8450,8452,8444,8445,8454,8456,8458,8457,8460,8491,8502,8504,10241,
    21051,21073,21052,21108,11015,10260,10262,10259,9136,8356,10198
)
ORDER BY price DESC
LIMIT 15;


-- ШАГ 2: КОНВЕРТИРОВАТЬ ОСТАВШИЕСЯ 90 ТОВАРОВ
-- ============================================================================
-- РАСКОММЕНТИРУЙТЕ СТРОКИ НИЖЕ:


UPDATE products
SET
    price = ROUND(price * 1.85, 2),
    old_price = CASE
        WHEN old_price IS NOT NULL AND old_price > 0
        THEN ROUND(old_price * 1.85, 2)
        ELSE old_price
    END,
    updated_at = NOW()
WHERE id IN (
    8206,8211,8213,8234,8244,8240,8243,8239,8235,8237,8236,8259,8252,8253,8255,8258,
    8249,8260,8254,8256,8261,8272,8251,8284,8287,8262,8304,8308,8296,8299,8300,8307,
    8293,8283,8297,8309,8337,8333,8340,8339,8352,8355,8353,8354,8360,8361,8368,8375,
    8376,8381,8382,8374,8365,8383,8380,8399,8390,8424,8425,8426,8427,8431,8434,8423,
    8448,8449,8450,8452,8444,8445,8454,8456,8458,8457,8460,8491,8502,8504,10241,
    21051,21073,21052,21108,11015,10260,10262,10259,9136,8356,10198
);



-- ШАГ 3: ПРОВЕРКА ПОСЛЕ КОНВЕРТАЦИИ
-- ============================================================================
SELECT
    'ТОВАРЫ ПОСЛЕ КОНВЕРТАЦИИ (RUB)' as status,
    COUNT(*) as total,
    MIN(price) as min_rub,
    MAX(price) as max_rub,
    ROUND(AVG(price), 2) as avg_rub
FROM products
WHERE id IN (
    8206,8211,8213,8234,8244,8240,8243,8239,8235,8237,8236,8259,8252,8253,8255,8258,
    8249,8260,8254,8256,8261,8272,8251,8284,8287,8262,8304,8308,8296,8299,8300,8307,
    8293,8283,8297,8309,8337,8333,8340,8339,8352,8355,8353,8354,8360,8361,8368,8375,
    8376,8381,8382,8374,8365,8383,8380,8399,8390,8424,8425,8426,8427,8431,8434,8423,
    8448,8449,8450,8452,8444,8445,8454,8456,8458,8457,8460,8491,8502,8504,10241,
    21051,21073,21052,21108,11015,10260,10262,10259,9136,8356,10198
);

-- Примеры после конвертации
SELECT
    id,
    price as price_rub,
    LEFT(name, 50) as product_name
FROM products
WHERE id IN (
    8206,8211,8213,8234,8244,8240,8243,8239,8235,8237,8236,8259,8252,8253,8255,8258,
    8249,8260,8254,8256,8261,8272,8251,8284,8287,8262,8304,8308,8296,8299,8300,8307,
    8293,8283,8297,8309,8337,8333,8340,8339,8352,8355,8353,8354,8360,8361,8368,8375,
    8376,8381,8382,8374,8365,8383,8380,8399,8390,8424,8425,8426,8427,8431,8434,8423,
    8448,8449,8450,8452,8444,8445,8454,8456,8458,8457,8460,8491,8502,8504,10241,
    21051,21073,21052,21108,11015,10260,10262,10259,9136,8356,10198
)
ORDER BY price DESC
LIMIT 15;


-- ШАГ 4: ИТОГОВАЯ ПРОВЕРКА ВСЕХ ТОВАРОВ TATA-AGRO
-- ============================================================================
SELECT
    'ИТОГОВАЯ ПРОВЕРКА ВСЕХ TATA-AGRO' as status,
    COUNT(*) as total_products,
    MIN(price) as min_price_rub,
    MAX(price) as max_price_rub,
    ROUND(AVG(price), 2) as avg_price_rub
FROM products
WHERE image_url LIKE '%tata-agro%'
  AND price IS NOT NULL
  AND price > 0;

-- Ожидаемый результат:
-- total_products: 286
-- min_price_rub: ~24 руб (после конвертации 13 грн × 1.85)
-- max_price_rub: ~24707 руб (после конвертации 13355 грн × 1.85)
-- avg_price_rub: ~2174 руб (после конвертации 1175 грн × 1.85)


-- ============================================================================
-- ИНСТРУКЦИЯ:
-- ============================================================================
-- 1. Запустите ШАГ 1 - посмотрите текущие цены 90 товаров
-- 2. Раскомментируйте UPDATE в ШАГ 2 (уберите /* и */)
-- 3. Выполните UPDATE - цены будут конвертированы
-- 4. Запустите ШАГ 3 - проверьте конвертированные товары
-- 5. Запустите ШАГ 4 - итоговая проверка ВСЕХ 286 товаров
--
-- РЕЗУЛЬТАТ:
-- ✅ ВСЕ 286 товаров tata-agro с ценами в рублях
-- ✅ Средняя цена ~2174 руб
-- ============================================================================
