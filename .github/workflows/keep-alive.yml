name: Keep Render Service Alive

# –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 14 –º–∏–Ω—É—Ç, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∑–∞—Å—ã–ø–∞–Ω–∏–µ –Ω–∞ Render (free tier —Å–ø–∏—Ç –ø–æ—Å–ª–µ 15 –º–∏–Ω)
on:
  schedule:
    # –ö–∞–∂–¥—ã–µ 14 –º–∏–Ω—É—Ç (–º–∞–∫—Å–∏–º—É–º –¥–ª—è GitHub Actions - –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, –Ω–æ –±—É–¥–µ–º —É–º–µ—Ä–µ–Ω–Ω—ã–º–∏)
    - cron: '*/14 * * * *'
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  keep-alive:
    runs-on: ubuntu-latest

    steps:
    - name: Ping production site
      run: |
        echo "üèì –ü–∏–Ω–≥—É–µ–º —Å–∞–π—Ç, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –∑–∞—Å–Ω—É–ª..."

        # –ü–∏–Ω–≥—É–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        response=$(curl -s -o /dev/null -w "%{http_code}" https://dongfeng-minitraktor.onrender.com/)
        echo "üì° –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: HTTP $response"

        # –ü–∏–Ω–≥—É–µ–º API health endpoint
        api_response=$(curl -s -o /dev/null -w "%{http_code}" https://dongfeng-minitraktor.onrender.com/api/health)
        echo "üíö API Health: HTTP $api_response"

        # –ü–∏–Ω–≥—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–æ–≤ (—á—Ç–æ–±—ã –ø—Ä–æ–≥—Ä–µ—Ç—å –ë–î)
        products_response=$(curl -s -o /dev/null -w "%{http_code}" https://dongfeng-minitraktor.onrender.com/api/products?limit=1)
        echo "üöú API Products: HTTP $products_response"

        if [ "$response" = "200" ] && [ "$api_response" = "200" ]; then
          echo "‚úÖ –°–∞–π—Ç –∂–∏–≤ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
        else
          echo "‚ö†Ô∏è  –°–∞–π—Ç –≤–µ—Ä–Ω—É–ª –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –∫–æ–¥"
          exit 1
        fi

    - name: Log timestamp
      run: |
        echo "‚è∞ –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–∏–Ω–≥: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
