#!/usr/bin/env python3
"""
–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PATTERN MATCHING
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤ –∏ —Ç–∏–ø–æ–≤ –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö
"""

import os
import sys

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
sys.path.insert(0, os.path.dirname(__file__))

# –ö–æ–ø–∏—Ä—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ migrate-parts-improved.py
BRAND_PATTERNS = {
    "perkins": ["perkins", "–ø–µ—Ä–∫–∏–Ω—Å"],
    "dongfeng-parts": [
        "dongfeng",
        "–¥–æ–Ω–≥—Ñ–µ–Ω–≥",
        "–¥—É–Ω—Ñ–µ–Ω–≥",
        "dong feng",
        "df-244",
        "df-404",
        "df 244",
        "df 404",
        "df244",
        "df404",
    ],
    "km-engines": ["–∫–º385", "–∫–º496", "ll380", "ll385", "km385", "km496", "yd385"],
    "uralets": ["—É—Ä–∞–ª–µ—Ü", "uralets"],
    "jinma": ["–¥–∂–∏–Ω–º–∞", "jinma", "jin ma"],
    "xingtai": ["—Å–∏–Ω—Ç–∞–π", "xingtai", "xing tai", "—Å–∏–Ω—Ç–∞–π-504"],
    "foton": ["—Ñ–æ—Ç–æ–Ω", "foton", "lovol"],
    "rusich": ["—Ä—É—Å–∏—á", "rusich"],
    "shifeng": ["—à–∏—Ñ–µ–Ω–≥", "shifeng", "shi feng"],
    "catmann": ["–∫—ç—Ç–º–∞–Ω–Ω", "catmann", "–∫–µ—Ç–º–∞–Ω–Ω"],
    "chuvashpiller": ["—á—É–≤–∞—à–ø–∏–ª–ª–µ—Ä", "chuvashpiller"],
    "bulat": ["–±—É–ª–∞—Ç", "bulat"],
    "yto": ["yto"],
    "wirax": ["wirax", "–≤–∏—Ä–∞–∫—Å"],
    "dlh": ["dlh"],
    "rustrak": ["—Ä—É—Å—Ç—Ä–∞–∫", "rustrak"],
    "mtz": ["–º—Ç–∑", "mtz", "–±–µ–ª–∞—Ä—É—Å", "belarus"],
    "scout": ["—Å–∫–∞—É—Ç —Ç-", "scout t-", "—Å–∫–∞—É—Ç-—Ç", "scout-t"],
    "kentavr": ["–∫–µ–Ω—Ç–∞–≤—Ä —Ç-", "kentavr t-", "—Ç-224", "t-224"],
    "fayter": ["—Ñ–∞–π—Ç–µ—Ä —Ç-", "fayter t-"],
    "neva": ["–Ω–µ–≤–∞", "neva", "–º–±-", "–º–± "],
    "t-series": ["—Ç-40", "—Ç-25", "—Ç-16", "t-40", "t-25", "t-16"],
}

TYPE_PATTERNS = {
    "diesel-engines": [
        "–¥–≤–∏–≥–∞—Ç–µ–ª—å",
        "–¥–≤–∏–≥–∞—Ç–µ–ª—è",
        "–º–æ—Ç–æ—Ä",
        "–ø–æ—Ä—à–µ–Ω—å",
        "–ø–æ—Ä—à–Ω–µ–≤—ã–µ",
        "–ø–æ—Ä—à–Ω—è",
        "—Ü–∏–ª–∏–Ω–¥—Ä",
        "–≥–∏–ª—å–∑–∞",
        "–≥–±—Ü",
        "–≥–æ–ª–æ–≤–∫–∞ –±–ª–æ–∫–∞",
        "–∫–æ–ª–µ–Ω–≤–∞–ª",
        "–∫–æ–ª–µ–Ω—á–∞—Ç—ã–π –≤–∞–ª",
        "—Ä–∞—Å–ø—Ä–µ–¥–≤–∞–ª",
        "–±–ª–æ–∫ —Ü–∏–ª–∏–Ω–¥—Ä–æ–≤",
        "–∫–∞—Ä—Ç–µ—Ä",
        "–º–∞—Ö–æ–≤–∏–∫",
        "—à–∞—Ç—É–Ω",
    ],
    "starters-generators": ["—Å—Ç–∞—Ä—Ç–µ—Ä", "–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"],
    "filters": ["—Ñ–∏–ª—å—Ç—Ä"],
    "driveshafts": ["–∫–∞—Ä–¥–∞–Ω", "–∫–∞—Ä–¥–∞–Ω–Ω—ã–π –≤–∞–ª", "–∫–∞—Ä–¥–∞–Ω–Ω—ã–π"],
    "hydraulics": [
        "–≥–∏–¥—Ä–∞–≤–ª–∏–∫",
        "–≥–∏–¥—Ä–æ—Ü–∏–ª–∏–Ω–¥—Ä",
        "–≥–∏–¥—Ä–æ–Ω–∞—Å–æ—Å",
        "–Ω—à-",
        "–Ω—à ",
        "–≥—É—Ä",
        "—Ä—É–ª–µ–≤–æ–π —Ü–∏–ª–∏–Ω–¥—Ä",
    ],
    "seats": ["—Å–∏–¥–µ–Ω—å–µ", "—Å–∏–¥–µ–Ω–∏–µ", "–∫—Ä–µ—Å–ª–æ"],
    "spare-parts-kit": ["–∑–∏–ø", "—Ä–µ–º–∫–æ–º–ø–ª–µ–∫—Ç", "—Ä–µ–º–æ–Ω—Ç–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç", "—Ä–µ–º.–∫–æ–º–ø–ª–µ–∫—Ç"],
    "equipment-parts": [
        "–∫–∞—Ä—Ç–æ—Ñ–µ–ª–µ–∫–æ–ø–∞–ª–∫–∞",
        "–∫–æ—Å–∏–ª–∫–∞",
        "–æ–∫—É—á–Ω–∏–∫",
        "–ø–ª—É–≥",
        "–±–æ—Ä–æ–Ω–∞",
        "—Ñ—Ä–µ–∑–∞",
        "—Å–Ω–µ–≥–æ—É–±–æ—Ä—â–∏–∫",
        "–ø—Ä–∏—Ü–µ–ø",
        "–ø–æ–≥—Ä—É–∑—á–∏–∫",
        "–ø—Ä–µ—Å—Å-–ø–æ–¥–±–æ—Ä—â–∏–∫",
        "–∫—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä",
    ],
    "wheels-tires": [
        "–∫–æ–ª–µ—Å–æ",
        "–∫–æ–ª—ë—Å",
        "–¥–∏—Å–∫ –∫–æ–ª–µ—Å–Ω",
        "—à–∏–Ω–∞",
        "—Ä–µ–∑–∏–Ω–∞",
        "–ø–æ–∫—Ä—ã—à–∫–∞",
        "–≥—Ä—É–∑ –∫–æ–ª–µ—Å–Ω",
        "–≥—Ä—É–Ω—Ç–æ–∑–∞—Ü–µ–ø",
    ],
    "standard-parts": [
        "–±–æ–ª—Ç",
        "–≥–∞–π–∫–∞",
        "—à–ø–∏–ª—å–∫–∞",
        "–≤–∏–Ω—Ç",
        "–ø—Ä–æ–∫–ª–∞–¥–∫–∞",
        "—Å–∞–ª—å–Ω–∏–∫",
        "–∫–æ–ª—å—Ü–æ —É–ø–ª–æ—Ç–Ω",
        "–∫–æ–ª—å—Ü–æ —Å—Ç–æ–ø–æ—Ä–Ω",
        "–º–∞–Ω–∂–µ—Ç–∞",
        "—à–∞–π–±–∞",
        "—à–ø–ª–∏–Ω—Ç",
        "–ø–∞–ª–µ—Ü —Å—Ç–æ–ø–æ—Ä–Ω",
        "—à—Ç–∏—Ñ—Ç",
        "–ø—Ä—É–∂–∏–Ω–∞",
    ],
    "tractor-parts": [
        "—Ä–µ–¥—É–∫—Ç–æ—Ä",
        "–∫–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á",
        "–∫–ø–ø",
        "—Å—Ü–µ–ø–ª–µ–Ω–∏–µ",
        "–∫–æ—Ä–∑–∏–Ω–∞",
        "–¥–∏—Å–∫ —Å—Ü–µ–ø–ª–µ–Ω–∏—è",
        "–≤–∞–ª",
        "–≤–æ–º",
        "–ø—Ä–∏–≤–æ–¥",
        "–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª",
        "—Ç–æ—Ä–º–æ–∑",
        "—Ç–æ—Ä–º–æ–∑–Ω",
    ],
    "universal-parts": ["—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω", "–∫–æ–º–ø–ª–µ–∫—Ç –ø—Ä–æ–∫–ª–∞–¥–æ–∫", "–Ω–∞–±–æ—Ä"],
    "other-parts": [
        "–ø—Ä–æ—á–∏–µ",
        "–ø—Ä–æ—á–µ–µ",
        "–Ω–∞–≤–µ—Å–Ω–æ–µ",
        "–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",
        "–∫—Ä–µ–ø–ª–µ–Ω–∏–µ",
        "–∫—Ä–æ–Ω—à—Ç–µ–π–Ω",
        "–∞–¥–∞–ø—Ç–µ—Ä",
        "–∫–∞–±–∏–Ω–∞",
        "–∫—Ä—ã–ª–æ",
        "–∑–µ—Ä–∫–∞–ª–æ",
        "–∫–æ–ª–ø–∞–∫",
        "–∫–æ–≤—à",
        "–±–æ—Ä—Ç",
        "—Ñ–∞—Ä–∫–æ–ø",
        "–±–∞–º–ø–µ—Ä",
        "—Ñ–∞—Ä–∞",
        "—Å—Ç–µ–∫–ª–æ",
        "—Ä—É–ª–µ–≤–æ–µ",
        "–ø–µ–¥–∞–ª—å",
    ],
}


def detect_brand(product_name: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±—Ä–µ–Ω–¥ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    name_lower = product_name.lower()

    for brand_key, patterns in BRAND_PATTERNS.items():
        for pattern in patterns:
            if pattern.lower() in name_lower:
                return brand_key

    return "universal"


def detect_type(product_name: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    name_lower = product_name.lower()

    for type_key, patterns in TYPE_PATTERNS.items():
        for pattern in patterns:
            if pattern.lower() in name_lower:
                return type_key

    return "other-parts"


# ============================================================================
# –¢–ï–°–¢–û–í–´–ï –ü–†–ò–ú–ï–†–´
# ============================================================================
test_products = [
    # DongFeng
    "–§–∏–ª—å—Ç—Ä –º–∞—Å–ª—è–Ω—ã–π DongFeng 244",
    "–°—Ç–∞—Ä—Ç–µ—Ä –¥–ª—è Dongfeng DF-404",
    "–ü–æ—Ä—à–µ–Ω—å –¥–≤–∏–≥–∞—Ç–µ–ª—è –î–æ–Ω–≥–§–µ–Ω–≥ 244",
    # –ö–ú –î–≤–∏–≥–∞—Ç–µ–ª–∏
    "–ì–∏–ª—å–∑–∞ —Ü–∏–ª–∏–Ω–¥—Ä–∞ KM385",
    "–ö–æ–ª–µ–Ω–≤–∞–ª –ö–ú385BT",
    "–ì–æ–ª–æ–≤–∫–∞ –±–ª–æ–∫–∞ —Ü–∏–ª–∏–Ω–¥—Ä–æ–≤ (–ì–ë–¶) KM385 –≤ —Å–±–æ—Ä–µ",
    "–ü–æ—Ä—à–µ–Ω—å LL380",
    # Jinma
    "–§–∏–ª—å—Ç—Ä —Ç–æ–ø–ª–∏–≤–Ω—ã–π Jinma 244",
    "–°–∏–¥–µ–Ω—å–µ –¥–ª—è —Ç—Ä–∞–∫—Ç–æ—Ä–∞ –î–∂–∏–Ω–º–∞",
    # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ
    "–ë–æ–ª—Ç –ú12—Ö50 (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)",
    "–ö–æ–º–ø–ª–µ–∫—Ç –ø—Ä–æ–∫–ª–∞–¥–æ–∫ –¥–≤–∏–≥–∞—Ç–µ–ª—è",
    "–§–∏–ª—å—Ç—Ä –º–∞—Å–ª—è–Ω—ã–π (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)",
    # –ú–¢–ó / –ë–µ–ª–∞—Ä—É—Å
    "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ú–¢–ó-80",
    "–§–∏–ª—å—Ç—Ä –≥–∏–¥—Ä–∞–≤–ª–∏—á–µ—Å–∫–∏–π –ë–µ–ª–∞—Ä—É—Å",
    # Perkins
    "–ü–æ—Ä—à–µ–Ω—å Perkins 1004",
    "–§–∏–ª—å—Ç—Ä –ü–µ—Ä–∫–∏–Ω—Å",
    # T-—Å–µ—Ä–∏—è
    "–°—Ü–µ–ø–ª–µ–Ω–∏–µ –¢-40",
    "–†–µ–¥—É–∫—Ç–æ—Ä –¢-25",
    # –°–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏
    "–ö–∞—Ä–¥–∞–Ω –¥–ª—è –º–∏–Ω–∏—Ç—Ä–∞–∫—Ç–æ—Ä–∞ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)",
    "–ì–∏–¥—Ä–æ—Ü–∏–ª–∏–Ω–¥—Ä —Ä—É–ª–µ–≤–æ–π",
    "–ö–æ–ª–µ—Å–æ 6.00-12 (–≥—Ä—É–Ω—Ç–æ–∑–∞—Ü–µ–ø)",
]

print("\n" + "=" * 100)
print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PATTERN MATCHING")
print("=" * 100 + "\n")

conflicts = []
results = []

for product_name in test_products:
    brand = detect_brand(product_name)
    ptype = detect_type(product_name)
    category_slug = f"{brand}-{ptype}"

    results.append(
        {"name": product_name, "brand": brand, "type": ptype, "slug": category_slug}
    )

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã (–µ—Å–ª–∏ –±—Ä–µ–Ω–¥ –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
    if brand == "universal" and any(
        keyword in product_name.lower() for keyword in ["dongfeng", "–∫–º", "km", "jinma"]
    ):
        conflicts.append(product_name)

# –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
for i, result in enumerate(results, 1):
    print(f"{i:2}. {result['name'][:60]:<60}")
    print(f"    ‚Üí –ë—Ä–µ–Ω–¥: {result['brand']:<20} –¢–∏–ø: {result['type']:<20}")
    print(f"    ‚Üí –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {result['slug']}")
    print()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
if conflicts:
    print("\n" + "=" * 100)
    print("‚ö†Ô∏è  –û–ë–ù–ê–†–£–ñ–ï–ù–´ –ö–û–ù–§–õ–ò–ö–¢–´:\n")
    for conflict in conflicts:
        print(f"  ‚ùå {conflict}")
    print("\nüí° –≠—Ç–∏ —Ç–æ–≤–∞—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏—Å—å –∫–∞–∫ 'universal', —Ö–æ—Ç—è —Å–æ–¥–µ—Ä–∂–∞—Ç –±—Ä–µ–Ω–¥!")
else:
    print("\n" + "=" * 100)
    print("‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ! Pattern matching —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")

print("=" * 100 + "\n")

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
from collections import Counter

brands = Counter(r["brand"] for r in results)
types = Counter(r["type"] for r in results)

print("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º:")
for brand, count in brands.most_common():
    print(f"  {brand:20} ‚Üí {count}")

print("\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º:")
for ptype, count in types.most_common():
    print(f"  {ptype:20} ‚Üí {count}")

print("\n" + "=" * 100)
print("üí° –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é!")
print("=" * 100 + "\n")
