# üéØ –ü–õ–ê–ù –ù–ê–í–ï–î–ï–ù–ò–Ø –ü–û–†–Ø–î–ö–ê –í –ë–î

## ‚ùå –ü–†–û–ë–õ–ï–ú–´ –°–ï–ô–ß–ê–°:

1. **5,846 —Ç–æ–≤–∞—Ä–æ–≤** –≤ –ë–î Supabase
2. –¢–æ–≤–∞—Ä—ã –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. –î–í–° –≤ —Å–±–æ—Ä–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–∞ –î–í–°"
4. –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ - –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ
5. –ü–æ–ª—è `category` (STRING) –∏ `category_id` (INT) –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

## ‚úÖ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ (–ü–û–®–ê–ì–û–í–û):

### –®–ê–ì 1: –°–û–ó–î–ê–¢–¨ –ü–†–ê–í–ò–õ–¨–ù–´–ï –ö–ê–¢–ï–ì–û–†–ò–ò –í –¢–ê–ë–õ–ò–¶–ï `categories`

```sql
-- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Supabase Dashboard ‚Üí SQL Editor

-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
INSERT INTO categories (name, slug) VALUES
('–ú–∏–Ω–∏—Ç—Ä–∞–∫—Ç–æ—Ä—ã', 'mini-tractors'),
('–î–í–° –≤ —Å–±–æ—Ä–µ', 'engines-assembled'),
('–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–∞ –î–í–°', 'engine-parts'),
('–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–∞ –ú–∏–Ω–∏—Ç—Ä–∞–∫—Ç–æ—Ä—ã', 'tractor-parts'),
('–•–æ–¥–æ–≤–∞—è —á–∞—Å—Ç—å', 'chassis'),
('–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è', 'transmission'),
('–ö–∞—Ä–¥–∞–Ω–Ω—ã–µ –≤–∞–ª—ã', 'cardan-shafts'),
('–¢–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', 'fuel-system'),
('–§–∏–ª—å—Ç—Ä—ã', 'filters'),
('–ì–∏–¥—Ä–∞–≤–ª–∏–∫–∞', 'hydraulics'),
('–ö–æ–ª—ë—Å–∞ –∏ —à–∏–Ω—ã', 'wheels-tires'),
('–≠–ª–µ–∫—Ç—Ä–∏–∫–∞', 'electrical'),
('–°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è', 'cooling-system'),
('–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', 'brake-system'),
('–†—É–ª–µ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', 'steering'),
('–†–µ–º–Ω–∏', 'belts'),
('–ù–∞–≤–µ—Å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', 'attachments'),
('–ü—Ä–µ—Å—Å-–ø–æ–¥–±–æ—Ä—â–∏–∫–∏', 'balers'),
('–ü–ª—É–≥–∏', 'plows'),
('–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä—ã', 'cultivators'),
('–ë–æ—Ä–æ–Ω—ã', 'harrows'),
('–ö–æ—Å–∏–ª–∫–∏', 'mowers'),
('–ì—Ä–∞–±–ª–∏-–≤–æ—Ä–æ—à–∏–ª–∫–∏', 'rakes'),
('–ü–æ—á–≤–æ—Ñ—Ä–µ–∑—ã', 'rotary-tillers'),
('–ö–∞—Ä—Ç–æ—Ñ–µ–ª–µ–∫–æ–ø–∞–ª–∫–∏', 'potato-diggers')
ON CONFLICT (slug) DO NOTHING;
```

### –®–ê–ì 2: –î–û–ë–ê–í–ò–¢–¨ –ò–ù–î–ï–ö–°–´ –î–õ–Ø –°–ö–û–†–û–°–¢–ò

```sql
-- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Supabase Dashboard ‚Üí SQL Editor

-- –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_products_category ON products(category);
CREATE INDEX IF NOT EXISTS idx_products_category_id ON products(category_id);
CREATE INDEX IF NOT EXISTS idx_products_manufacturer ON products(manufacturer);
CREATE INDEX IF NOT EXISTS idx_products_brand ON products(brand);
CREATE INDEX IF NOT EXISTS idx_products_title_gin ON products USING GIN (to_tsvector('russian', title));

-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_products_category_stock ON products(category, stock) WHERE stock > 0;
CREATE INDEX IF NOT EXISTS idx_products_manufacturer_category ON products(manufacturer, category);

-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
ANALYZE products;
```

### –®–ê–ì 3: –ò–°–ü–†–ê–í–ò–¢–¨ –ö–ê–¢–ï–ì–û–†–ò–ò –î–í–°

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
cd /home/ibm/dongfeng-minitraktor
./scripts/fix-categories-fast.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ SQL:
```sql
-- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–µ –î–í–° –∏–∑ "–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–∞ –î–í–°" –≤ "–î–í–° –≤ —Å–±–æ—Ä–µ"
UPDATE products
SET category = '–î–í–° –≤ —Å–±–æ—Ä–µ'
WHERE category = '–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–∞ –î–í–°'
  AND (
    title ILIKE '%–î–≤–∏–≥–∞—Ç–µ–ª—å –¥–∏–∑–µ–ª—å–Ω—ã–π%–ª.—Å%' OR
    title ILIKE '%–î–∏–∑–µ–ª—å–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å%–ª.—Å%'
  )
  AND title NOT ILIKE '%—Ä–µ–¥—É–∫—Ç–æ—Ä%'
  AND title NOT ILIKE '%–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä%'
  AND title NOT ILIKE '%—Å—Ç–∞—Ä—Ç–µ—Ä%';
```

### –®–ê–ì 4: –°–ò–ù–•–†–û–ù–ò–ó–ò–†–û–í–ê–¢–¨ category_id

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å category_id –Ω–∞ –æ—Å–Ω–æ–≤–µ category (STRING)
UPDATE products p
SET category_id = c.id
FROM categories c
WHERE p.category = c.name
  AND p.category_id IS NULL;
```

### –®–ê–ì 5: –ü–†–û–í–ï–†–ò–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
SELECT category, COUNT(*) as count
FROM products
WHERE category IS NOT NULL
GROUP BY category
ORDER BY count DESC
LIMIT 20;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–í–°
SELECT id, title, category
FROM products
WHERE category = '–î–í–° –≤ —Å–±–æ—Ä–µ'
ORDER BY id;
```

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ (–î–õ–Ø –õ–ï–ù–ò–í–´–•):

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard/project/dpsykseeqloturowdyzf/sql
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–ï–°–¨ SQL –∏–∑ –®–∞–≥–æ–≤ 1-4
3. –ù–∞–∂–º–∏—Ç–µ RUN
4. –ì–æ—Ç–æ–≤–æ! ‚úÖ

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:

- ‚úÖ –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã ‚Üí –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 5-10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ
- ‚úÖ –î–í–° –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–î–í–° –≤ —Å–±–æ—Ä–µ"
- ‚úÖ category –∏ category_id —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥ –Ω–∞ —Å–∞–π—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üõ†Ô∏è –ì–û–¢–û–í–´–ï –°–ö–†–ò–ü–¢–´:

1. `scripts/fix-categories-fast.sh` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –î–í–°
2. `scripts/analyze-db-simple.py` - –∞–Ω–∞–ª–∏–∑ –ë–î
3. `INDEXES.sql` - SQL –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤
4. `docs/supabase-schema.sql` - –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î

---

## ‚ùì –ß–¢–û –î–ê–õ–¨–®–ï?

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω—É–∂–Ω–æ:
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ `part_type` –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ `brand` –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ

**–ù–æ —ç—Ç–æ –ø–æ—Ç–æ–º! –°–Ω–∞—á–∞–ª–∞ –Ω–∞–≤–æ–¥–∏–º –ø–æ—Ä—è–¥–æ–∫ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏!** üí™
